<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Premium Poster Generator Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Bebas+Neue&family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:wght@300;400;600;700&family=Playfair+Display:wght@400;700;900&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
<style>
@font-face{font-family:'ITC Benguiat';src:url('https://cdn.jsdelivr.net/gh/toribiodiego/Stranger-Things@main/ITCBenguiatStd-Bold.woff') format('woff');font-weight:bold;font-style:normal}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Arial,sans-serif;background:#e2e8f0;color:#1a202c;overflow-x:hidden}
.header{background:linear-gradient(135deg,#1a202c 0%,#2d3748 100%);color:#fff;padding:40px 20px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,.2)}
.header h1{font-size:32px;letter-spacing:2px;margin-bottom:8px;font-weight:700}
.container{max-width:1600px;margin:0 auto;padding:40px 20px}
.grid{display:grid;grid-template-columns:420px 1fr;gap:40px}
.panel{background:#fff;border-radius:20px;padding:25px;box-shadow:0 10px 25px rgba(0,0,0,.05);margin-bottom:20px;border:1px solid rgba(0,0,0,.05)}
.panel h2{font-size:14px;margin-bottom:20px;text-transform:uppercase;letter-spacing:1.5px;color:#718096}
.btn-group{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.btn{padding:14px;border:2px solid #edf2f7;border-radius:12px;background:#fff;cursor:pointer;transition:all .2s ease;font-size:12px;font-weight:700}
.btn.active{border-color:#2d3748;background:#2d3748;color:#fff}
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:11px;font-weight:800;margin-bottom:8px;color:#a0aec0;text-transform:uppercase}
.form-group input, .form-group select{width:100%;padding:12px;border:2px solid #edf2f7;border-radius:10px;font-size:14px;outline:none;transition:0.2s}
.form-group input:focus{border-color:#4a5568}
.theme-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.export-btn{width:100%;padding:18px;border:none;border-radius:12px;font-size:14px;font-weight:800;cursor:pointer;transition:0.3s;letter-spacing:1px}
.export-btn.primary{background:#2d3748;color:#fff;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1)}
.canvas-container{background:#cbd5e0;border-radius:30px;padding:60px;display:flex;justify-content:center;align-items:center;min-height:900px;position:sticky;top:20px}
#posterCanvas{max-width:100%;height:auto;border-radius:4px;box-shadow:0 40px 100px rgba(0,0,0,0.4);background:#000}
@media(max-width:1200px){.grid{grid-template-columns:1fr}.canvas-container{position:relative;padding:20px}}
</style>
</head>
<body>
<div class="header"><h1>POSTER STUDIO PRO</h1><p>High-Fidelity Cartography & Celestial Art</p></div>
<div class="container">
    <div class="grid">
        <div class="controls">
            <div class="panel">
                <h2>Art Type</h2>
                <div class="btn-group">
                    <button class="btn active" onclick="setType('map')" id="btn-map">STREET MAP</button>
                    <button class="btn" onclick="setType('star')" id="btn-star">STAR CHART</button>
                </div>
            </div>
            <div class="panel">
                <h2>Frame & Geometry</h2>
                <div class="btn-group">
                    <button class="btn active" onclick="setShape('full')" id="btn-full">FULL FRAME</button>
                    <button class="btn" onclick="setShape('circle')" id="btn-circle">CIRCULAR MASK</button>
                </div>
            </div>
            <div class="panel">
                <h2>Location & View</h2>
                <div class="form-group">
                    <label>Search City</label>
                    <input type="text" id="locationSearch" placeholder="Enter city name..." oninput="handleLocationInput()">
                    <div id="locationSuggestions" style="display:none;position:absolute;z-index:100;width:370px;background:#fff;box-shadow:0 10px 25px rgba(0,0,0,0.1);border-radius:10px;overflow:hidden"></div>
                </div>
                <div class="form-group">
                    <label>Zoom Level</label>
                    <input type="range" id="zoomInput" min="0.8" max="3.5" value="1.5" step="0.1" oninput="updateZoom()">
                </div>
                <button class="export-btn primary" onclick="useMyLocation()">LOCATE ME</button>
            </div>
            <div class="panel">
                <h2>Typography</h2>
                <div class="form-group"><label>Main Heading</label><input type="text" id="titleInput" value="LONDON" oninput="drawPoster()"></div>
                <div class="form-group"><label>Subtext</label><input type="text" id="subtitleInput" value="51.5074째 N, 0.1278째 W" oninput="drawPoster()"></div>
                <div class="form-group"><label>Tagline</label><input type="text" id="messageInput" placeholder="Add a date or phrase..." oninput="drawPoster()"></div>
                <div class="form-group">
                    <label>Typography Style</label>
                    <select id="fontSelect" onchange="drawPoster()">
                        <option value="Poppins">Poppins (Modern)</option>
                        <option value="Playfair Display">Playfair (Classic)</option>
                        <option value="Cinzel">Cinzel (Decorative)</option>
                        <option value="Bebas Neue">Bebas (Bold)</option>
                        <option value="ITC Benguiat">Stranger Things</option>
                    </select>
                </div>
            </div>
            <div class="panel">
                <h2>Color Palette</h2>
                <div class="theme-grid">
                    <button class="btn active" onclick="setTheme('darkmode')" id="theme-darkmode">Midnight</button>
                    <button class="btn" onclick="setTheme('modern')" id="theme-modern">Gallery White</button>
                    <button class="btn" onclick="setTheme('vintage')" id="theme-vintage">Heritage</button>
                    <button class="btn" onclick="setTheme('strangerthings')" id="theme-strangerthings">The Void</button>
                    <button class="btn" onclick="setTheme('cyberpunk')" id="theme-cyberpunk">Neon City</button>
                </div>
            </div>
            <button class="export-btn primary" onclick="exportPoster()">DOWNLOAD HIGH-RES PNG</button>
        </div>
        <div class="canvas-container">
            <canvas id="posterCanvas" width="2480" height="3508"></canvas>
        </div>
    </div>
</div>

<script>
const offCanvas = document.createElement('canvas');
offCanvas.width = 2480; offCanvas.height = 3508;
const offCtx = offCanvas.getContext('2d');

let state = {
    type: 'map', theme: 'darkmode', shape: 'full', zoom: 1.5,
    loc: {lat: 51.5074, lon: -0.1278, name: 'London'},
    mapData: null
};

const themes = {
    darkmode: {bg: '#0a0a0a', mask: '#151515', st: '#333', rd: '#555', hw: '#fff', mk: '#fff', accent: '#444'},
    modern: {bg: '#ffffff', mask: '#f8fafc', st: '#e2e8f0', rd: '#94a3b8', hw: '#1e293b', mk: '#1e293b', accent: '#f1f5f9'},
    vintage: {bg: '#f4ece1', mask: '#e8dfd0', st: '#d6c8b1', rd: '#a69076', hw: '#4a3728', mk: '#4a3728', accent: '#dfd5c3'},
    strangerthings: {bg: '#050000', mask: '#120000', st: '#440000', rd: '#e60000', hw: '#ff0000', mk: '#ff0000', glow: true},
    cyberpunk: {bg: '#020205', mask: '#0a0a1a', st: '#003333', rd: '#00ffff', hw: '#00ffff', mk: '#fff', glow: true}
};

function setTheme(t) {
    state.theme = t;
    document.querySelectorAll('.theme-grid .btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`theme-${t}`).classList.add('active');
    drawPoster();
}

function setType(t) {
    state.type = t;
    document.querySelectorAll('#btn-map, #btn-star').forEach(b => b.classList.remove('active'));
    document.getElementById(`btn-${t}`).classList.add('active');
    drawPoster();
}

function setShape(s) {
    state.shape = s;
    document.querySelectorAll('#btn-full, #btn-circle').forEach(b => b.classList.remove('active'));
    document.getElementById(`btn-${s}`).classList.add('active');
    drawPoster();
}

async function fetchMapData(lat, lon) {
    const r = state.zoom * 0.035;
    const q = `[out:json];(way["highway"](${lat-r},${lon-r},${lat+r},${lon+r});way["waterway"](${lat-r},${lon-r},${lat+r},${lon+r}););out geom;`;
    const res = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(q)}`);
    const d = await res.json();
    state.mapData = d.elements;
    drawPoster();
}

function drawPoster() {
    const mainCanvas = document.getElementById('posterCanvas');
    const ctx = offCtx;
    const col = themes[state.theme];
    
    // 1. Background
    ctx.fillStyle = col.bg;
    ctx.fillRect(0, 0, 2480, 3508);

    // 2. Main Content Area (With Masking Logic)
    ctx.save();
    const centerX = 1240, centerY = 1450, radius = 1000;
    
    if (state.shape === 'circle') {
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.fillStyle = col.mask; // Automatic themed mask color
        ctx.fill();
        ctx.clip();
    }

    if (state.type === 'map' && state.mapData) {
        renderMapContent(ctx, col, centerX, centerY);
    } else if (state.type === 'star') {
        renderStarContent(ctx, col, centerX, centerY, radius);
    }
    ctx.restore();

    // 3. Frame & Labels
    renderLabels(ctx, col);
    
    // Heavy Border
    ctx.strokeStyle = col.hw;
    ctx.lineWidth = 12;
    ctx.strokeRect(80, 80, 2320, 3348);

    // Flip buffer to screen
    mainCanvas.getContext('2d').drawImage(offCanvas, 0, 0);
}

function renderMapContent(ctx, col, cx, cy) {
    const ms = 42000 * state.zoom;
    ctx.lineCap = 'round';
    
    state.mapData.forEach(e => {
        if(!e.geometry) return;
        const isMain = e.tags.highway && ['primary','secondary','motorway','trunk'].includes(e.tags.highway);
        
        ctx.beginPath();
        ctx.strokeStyle = isMain ? col.rd : col.st;
        ctx.lineWidth = isMain ? 8 : 3;
        
        if(col.glow && isMain) {
            ctx.shadowBlur = 15; ctx.shadowColor = col.rd;
        }

        e.geometry.forEach((p, i) => {
            const x = cx + (p.lon - state.loc.lon) * ms * Math.cos(state.loc.lat * Math.PI/180);
            const y = cy - (p.lat - state.loc.lat) * ms;
            if(i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.shadowBlur = 0;
    });

    // Marker
    ctx.fillStyle = col.mk;
    ctx.beginPath(); ctx.arc(cx, cy, 14, 0, Math.PI*2); ctx.fill();
}

function renderStarContent(ctx, col, cx, cy, radius) {
    for(let i=0; i<800; i++) {
        const x = cx + (Math.random()-0.5) * 2500;
        const y = cy + (Math.random()-0.5) * 2500;
        const size = Math.random() * 4;
        ctx.fillStyle = col.hw;
        ctx.globalAlpha = Math.random();
        ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1.0;
}

function renderLabels(ctx, col) {
    const title = document.getElementById('titleInput').value.toUpperCase();
    const sub = document.getElementById('subtitleInput').value;
    const msg = document.getElementById('messageInput').value;
    const font = document.getElementById('fontSelect').value;

    ctx.textAlign = 'center';
    
    // Dynamic Label Sizing
    function drawLabelBlock(text, y, fontSize, weight, padding) {
        ctx.font = `${weight} ${fontSize}px ${font}`;
        const metrics = ctx.measureText(text);
        const w = metrics.width + padding * 2;
        const h = fontSize * 1.5;
        
        ctx.fillStyle = col.hw;
        ctx.fillRect(1240 - w/2, y, w, h);
        
        ctx.fillStyle = col.bg;
        ctx.fillText(text, 1240, y + h/1.4);
        return h;
    }

    let currentY = 2750;
    currentY += drawLabelBlock(title, currentY, 90, '700', 80) + 30;
    currentY += drawLabelBlock(sub, currentY, 40, '400', 50) + 50;
    if(msg) drawLabelBlock(msg, currentY, 32, '300 italic', 40);
}

function updateZoom() {
    state.zoom = parseFloat(document.getElementById('zoomInput').value);
    fetchMapData(state.loc.lat, state.loc.lon);
}

function handleLocationInput() {
    const q = document.getElementById('locationSearch').value;
    if(q.length < 3) return;
    fetch(`https://nominatim.openstreetmap.org/search?q=${q}&format=json&limit=5`)
    .then(r => r.json()).then(data => {
        const sug = document.getElementById('locationSuggestions');
        sug.innerHTML = ''; sug.style.display = 'block';
        data.forEach(d => {
            const item = document.createElement('div');
            item.style.padding = '12px'; item.style.cursor = 'pointer'; item.style.borderBottom = '1px solid #eee';
            item.innerText = d.display_name;
            item.onclick = () => {
                state.loc = {lat: parseFloat(d.lat), lon: parseFloat(d.lon), name: d.display_name.split(',')[0]};
                document.getElementById('titleInput').value = state.loc.name.toUpperCase();
                document.getElementById('subtitleInput').value = `${state.loc.lat.toFixed(4)}째 N, ${state.loc.lon.toFixed(4)}째 W`;
                sug.style.display = 'none';
                fetchMapData(state.loc.lat, state.loc.lon);
            };
            sug.appendChild(item);
        });
    });
}

function useMyLocation() {
    navigator.geolocation.getCurrentPosition(p => {
        state.loc = {lat: p.coords.latitude, lon: p.coords.longitude, name: 'CURRENT LOCATION'};
        fetchMapData(state.loc.lat, state.loc.lon);
    });
}

function exportPoster() {
    const link = document.createElement('a');
    link.download = `poster-${state.loc.name}.png`;
    link.href = document.getElementById('posterCanvas').toDataURL('image/png', 1.0);
    link.click();
}

// Start
fetchMapData(state.loc.lat, state.loc.lon);
</script>
</body>
</html>
