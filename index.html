<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Premium Poster Generator — Optimized</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Bebas+Neue&family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:wght@300;400;600;700&family=Playfair+Display:wght@400;700;900&family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Arial,sans-serif;background:#f2f3f5;color:#1f2937}
.header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:28px 18px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,.18)}
.header h1{font-size:30px;font-weight:700;margin-bottom:6px}
.container{max-width:1600px;margin:0 auto;padding:28px 18px}
.grid{display:grid;grid-template-columns:380px 1fr;gap:28px}
.panel{background:#fff;border-radius:16px;padding:24px;box-shadow:0 2px 12px rgba(0,0,0,.08)}
.panel h2{font-size:18px;margin-bottom:16px;border-bottom:2px solid #e5e7eb;padding-bottom:10px}
.btn-group{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.btn{padding:12px;border:2px solid #ddd;border-radius:10px;background:#fff;font-size:13px;font-weight:500;cursor:pointer;transition:.25s}
.btn:hover{border-color:#667eea;transform:translateY(-1px);box-shadow:0 4px 8px rgba(102,126,234,.25)}
.btn.active{border-color:#667eea;background:linear-gradient(135deg,#667eea17,#764ba217);color:#667eea}
.theme-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.canvas-container{background:#fff;border-radius:16px;padding:26px;box-shadow:0 2px 12px rgba(0,0,0,.08);display:flex;justify-content:center;align-items:center;position:relative}
#posterCanvas{max-width:100%;height:auto;border-radius:8px;box-shadow:0 10px 24px rgba(0,0,0,.14)}
.loading-overlay{position:absolute;inset:0;border-radius:16px;background:linear-gradient(135deg,#667eea,#764ba2);display:none;align-items:center;justify-content:center}
.loading-overlay.show{display:flex}
.spinner{width:46px;height:46px;border-radius:50%;border:4px solid rgba(255,255,255,.28);border-top-color:#fff;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:1200px){.grid{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="header">
<h1>Premium Poster Generator</h1>
<p>Optimized rendering, enhanced visuals, Cyberpunk neon upgrade</p>
</div>

<div class="container">
<div class="grid">

<!-- LEFT CONTROLS -->
<div>
<div class="panel">
<h2>Poster Type</h2>
<div class="btn-group">
<button class="btn active" onclick="setPosterType('map')" id="btn-map">Map</button>
<button class="btn" onclick="setPosterType('star')" id="btn-star">Stars</button>
</div>
</div>

<div class="panel">
<h2>Zoom</h2>
<input type="range" id="zoomInput" min="0.8" max="3" value="1.5" step="0.1" oninput="updateZoom()">
<div style="margin-top:6px;font-size:13px">Level: <span id="zoomValue">1.5</span>x</div>
</div>

<div class="panel">
<h2>Text</h2>
<input type="text" id="titleInput" value="NEW YORK" oninput="debouncedDraw()" placeholder="Title" style="margin-bottom:8px">
<input type="text" id="subtitleInput" value="40.7128° N, 74.0060° W" oninput="debouncedDraw()" placeholder="Subtitle" style="margin-bottom:8px">
<input type="text" id="messageInput" oninput="debouncedDraw()" placeholder="Tagline (optional)">
</div>

<div class="panel">
<h2>Themes</h2>
<div class="theme-grid">
<button class="btn active" onclick="setTheme('darkmode')" id="theme-darkmode">Dark Mode</button>
<button class="btn" onclick="setTheme('modern')" id="theme-modern">Modern</button>
<button class="btn" onclick="setTheme('vintage')" id="theme-vintage">Vintage</button>
<button class="btn" onclick="setTheme('cyberpunk')" id="theme-cyberpunk">Cyberpunk Neon</button>
</div>
</div>

</div>

<!-- RIGHT CANVAS -->
<div>
<div class="canvas-container">
<div class="loading-overlay" id="loadingOverlay">
<div class="spinner"></div>
</div>
<canvas id="posterCanvas" width="2480" height="3508"></canvas>
</div>
</div>

</div>
</div>

<script>
/* ---------- PERFORMANCE CORE ---------- */

let drawPending = false;
let mapCacheCanvas = document.createElement("canvas");
let mapCacheCtx = mapCacheCanvas.getContext("2d");
let mapCacheKey = null;

const canvas = document.getElementById("posterCanvas");
const ctx = canvas.getContext("2d");

let state = {
  posterType: "map",
  theme: "darkmode",
  zoom: 1.5,
  loc: { lat: 40.7128, lon: -74.006, name: "New York" }
};

/* ---------- VISUAL THEMES (ENHANCED) ---------- */
/* Cyberpunk inspired by 2077 neon palette:
   high-contrast deep black base, hot neon red + cyan highlights */

const themes = {
  darkmode:{
    bg:"#0a0a0a", shapeBg:"#141414",
    st:"#ffffff", rd:"#e8e8e8", mk:"#ffffff",
    text:"#ffffff", label:"#cfcfcf"
  },

  modern:{
    bg:"#f8f9fa", shapeBg:"#e8eaed",
    st:"#d6e0f0", rd:"#9fb0c6", mk:"#1a2530",
    text:"#1f2937", label:"#6b7280"
  },

  vintage:{
    bg:"#f4e8d8", shapeBg:"#e9dec9",
    st:"#dacbb0", rd:"#b6a07f", mk:"#3e3224",
    text:"#3b2f23", label:"#7a6a54"
  },

  /* ---------- CYBERPUNK 2077 NEON RED UPGRADE ---------- */
  cyberpunk:{
    bg:"#050505",
    shapeBg:"#0b0b0f",

    /* Roads: thicker + neon hot-red */
    rd:"#ff004c",       /* neon magenta-red */
    rdGlow:"#ff2a6d",   /* outer glow hue */
    rdWidth:3.2,        /* thicker for cyberpunk */

    /* Streets / small lines */
    st:"#00f0ff",       /* neon cyan accent */

    /* Markers / POIs */
    mk:"#ffe600",       /* electric yellow highlight */

    /* Text vs label auto contrast */
    text:"#ff004c",
    label:"#00f0ff"
  }
};

/* ---------- CONTRAST LOGIC FOR LABEL TEXT ---------- */

function getContrastingColor(hex){
  hex = hex.replace("#","");
  const r = parseInt(hex.substr(0,2),16);
  const g = parseInt(hex.substr(2,2),16);
  const b = parseInt(hex.substr(4,2),16);
  const luminance = (0.299*r + 0.587*g + 0.114*b)/255;
  return luminance > 0.55 ? "#111" : "#ffffff";
}

/* ---------- LIGHTWEIGHT DRAW PIPELINE ---------- */

function scheduleDraw(){
  if(drawPending) return;
  drawPending = true;
  requestAnimationFrame(()=>{ drawPending = false; drawPoster(); });
}

function debouncedDraw(){
  clearTimeout(window.drawDebounce);
  window.drawDebounce = setTimeout(scheduleDraw, 120);
}

function setPosterType(type){
  state.posterType = type;
  scheduleDraw();
}

function setTheme(name){
  document.querySelectorAll(".theme-grid .btn").forEach(b=>b.classList.remove("active"));
  document.getElementById("theme-"+name).classList.add("active");
  state.theme = name;
  scheduleDraw();
}

function updateZoom(){
  const z = parseFloat(document.getElementById("zoomInput").value);
  state.zoom = z;
  document.getElementById("zoomValue").innerText = z.toFixed(1);
  scheduleDraw();
}

/* ---------- MAP CACHE & RENDER ---------- */

function drawMapToCache(){
  const key = `${state.loc.lat}|${state.loc.lon}|${state.zoom}|${state.theme}`;
  if(key === mapCacheKey) return;

  mapCacheKey = key;
  mapCacheCanvas.width = canvas.width;
  mapCacheCanvas.height = canvas.height;

  const theme = themes[state.theme];

  /* Base shape background */
  mapCacheCtx.fillStyle = theme.shapeBg || theme.bg;
  mapCacheCtx.fillRect(0,0,mapCacheCanvas.width,mapCacheCanvas.height);

  /* Fake vector road rendering (placeholder demo style)
     You can swap with real tile/vector data renderer */

  // streets
  mapCacheCtx.strokeStyle = theme.st;
  mapCacheCtx.lineWidth = 0.6 * state.zoom;
  mapCacheCtx.beginPath();
  for(let i=0;i<50;i++){
    const x = (i*70*state.zoom)%mapCacheCanvas.width;
    mapCacheCtx.moveTo(x,200);
    mapCacheCtx.lineTo(x+400, 1200);
  }
  mapCacheCtx.stroke();

  // roads (Cyberpunk thicker + neon glow)
  if(state.theme === "cyberpunk"){
    mapCacheCtx.strokeStyle = theme.rdGlow;
    mapCacheCtx.lineWidth = theme.rdWidth * 2.4;
    mapCacheCtx.globalAlpha = .35;
    mapCacheCtx.beginPath();
    mapCacheCtx.moveTo(200,300); mapCacheCtx.lineTo(2200,2000);
    mapCacheCtx.moveTo(300,500); mapCacheCtx.lineTo(2400,2600);
    mapCacheCtx.stroke();

    mapCacheCtx.globalAlpha = 1;
    mapCacheCtx.strokeStyle = theme.rd;
    mapCacheCtx.lineWidth = theme.rdWidth;
    mapCacheCtx.beginPath();
    mapCacheCtx.moveTo(200,300); mapCacheCtx.lineTo(2200,2000);
    mapCacheCtx.moveTo(300,500); mapCacheCtx.lineTo(2400,2600);
    mapCacheCtx.stroke();
  }
  else{
    mapCacheCtx.strokeStyle = theme.rd;
    mapCacheCtx.lineWidth = 1.4 * state.zoom;
    mapCacheCtx.beginPath();
    mapCacheCtx.moveTo(200,300); mapCacheCtx.lineTo(2200,2000);
    mapCacheCtx.moveTo(300,500); mapCacheCtx.lineTo(2400,2600);
    mapCacheCtx.stroke();
  }
}

/* ---------- POSTER TEXT + LABELS ---------- */

function drawLabels(theme){
  const title = document.getElementById("titleInput").value;
  const subtitle = document.getElementById("subtitleInput").value;
  const tagline = document.getElementById("messageInput").value;

  const labelColor = theme.label;
  const textColor = theme.text || getContrastingColor(labelColor);

  // label line
  ctx.fillStyle = labelColor;
  ctx.font = "28px Poppins";
  ctx.fillText("LOCATION", 200, 300);

  // opposite contrast text
  ctx.fillStyle = textColor;
  ctx.font = "78px Poppins";
  ctx.fillText(title, 200, 380);

  ctx.fillStyle = textColor;
  ctx.font = "38px Poppins";
  ctx.fillText(subtitle, 200, 450);

  if(tagline){
    ctx.fillStyle = labelColor;
    ctx.font = "30px Poppins";
    ctx.fillText(tagline, 200, 520);
  }
}

/* ---------- MASTER DRAW ---------- */

function drawPoster(){
  const theme = themes[state.theme];

  ctx.fillStyle = theme.bg;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawMapToCache();
  ctx.drawImage(mapCacheCanvas,0,0);

  drawLabels(theme);
}

scheduleDraw();
</script>
</body>
</html>

