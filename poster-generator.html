<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Poster Generator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f5f5; color: #333; }
        .header { background: white; border-bottom: 1px solid #e0e0e0; padding: 20px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        .header p { color: #666; font-size: 14px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .panel { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .panel h2 { font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .btn-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .btn { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; transition: all 0.2s; font-size: 12px; text-align: center; }
        .btn:hover { border-color: #999; }
        .btn.active { border-color: #2563eb; background: #eff6ff; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .checkbox-group { display: flex; align-items: center; gap: 8px; margin-top: 12px; }
        .checkbox-group input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .theme-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .export-btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-bottom: 8px; }
        .export-btn.primary { background: #2563eb; color: white; }
        .export-btn.primary:hover { background: #1d4ed8; }
        .export-btn.secondary { background: #6b7280; color: white; }
        .export-btn.secondary:hover { background: #4b5563; }
        .canvas-container { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; justify-content: center; align-items: center; }
        #posterCanvas { max-width: 100%; height: auto; border: 1px solid #e0e0e0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        @media (max-width: 1024px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé® Custom Poster Generator</h1>
        <p>Create beautiful map, star map, and typography posters ‚Ä¢ Free & Open Source ‚Ä¢ Made with ‚ù§Ô∏è</p>
    </div>

    <div class="container">
        <div class="grid">
            <div>
                <div class="panel">
                    <h2>üìã Poster Type</h2>
                    <div class="btn-group">
                        <button class="btn active" onclick="setPosterType('map')" id="btn-map">üó∫Ô∏è<br>Map</button>
                        <button class="btn" onclick="setPosterType('star')" id="btn-star">‚≠ê<br>Stars</button>
                        <button class="btn" onclick="setPosterType('text')" id="btn-text">üìù<br>Text</button>
                    </div>
                </div>

                <div class="panel">
                    <h2>üìç Location</h2>
                    <button class="export-btn primary" onclick="useMyLocation()" style="margin-bottom: 16px;">üìç Use My GPS Location</button>
                    <div style="text-align: center; margin-bottom: 16px; color: #666; font-size: 12px;">‚Äî OR ‚Äî</div>
                    <div class="form-group">
                        <label>Search Location</label>
                        <input type="text" id="locationSearch" placeholder="Enter city, address, or coordinates..." oninput="handleLocationInput()">
                        <div id="locationSuggestions" style="display:none; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; margin-top: 8px; background: white;"></div>
                    </div>
                    <div style="text-align: center; margin-bottom: 16px; color: #666; font-size: 12px;">‚Äî OR ‚Äî</div>
                    <div class="form-group">
                        <label>Manual Coordinates</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <input type="number" id="manualLat" placeholder="Latitude" step="0.0001" min="-90" max="90" onchange="handleManualCoords()">
                            <input type="number" id="manualLon" placeholder="Longitude" step="0.0001" min="-180" max="180" onchange="handleManualCoords()">
                        </div>
                        <button class="btn" onclick="applyManualCoords()" style="width: 100%; margin-top: 8px;">Apply Coordinates</button>
                    </div>
                    <div id="currentLocationDisplay" style="background: #f0f0f0; padding: 12px; border-radius: 8px; margin-top: 12px; font-size: 13px; display: none;">
                        <strong>Current Location:</strong><br>
                        <span id="locationDisplayText"></span>
                    </div>
                    <div id="starControls" style="display: none; margin-top: 16px;">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="dateInput" value="2024-01-01" onchange="drawPoster()">
                        </div>
                        <div class="form-group">
                            <label>Time</label>
                            <input type="time" id="timeInput" value="20:00" onchange="drawPoster()">
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h2>‚úèÔ∏è Text</h2>
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="titleInput" value="NEW YORK" oninput="drawPoster()">
                    </div>
                    <div class="form-group">
                        <label>Subtitle</label>
                        <input type="text" id="subtitleInput" value="40.7128¬∞ N, 74.0060¬∞ W" oninput="drawPoster()">
                    </div>
                    <div class="form-group">
                        <label>Custom Message</label>
                        <input type="text" id="messageInput" placeholder="Where our story began..." oninput="drawPoster()">
                    </div>
                    <div class="form-group">
                        <label>Font Size: <span id="fontSizeValue">48</span>px</label>
                        <input type="range" id="fontSizeInput" min="24" max="72" value="48" oninput="updateFontSize()">
                    </div>
                </div>

                <div class="panel">
                    <h2>üé® Theme</h2>
                    <div class="theme-grid">
                        <button class="btn active" onclick="setTheme('light')" id="theme-light">Light</button>
                        <button class="btn" onclick="setTheme('dark')" id="theme-dark">Dark</button>
                        <button class="btn" onclick="setTheme('blue')" id="theme-blue">Blue</button>
                        <button class="btn" onclick="setTheme('beige')" id="theme-beige">Beige</button>
                    </div>
                    <div class="checkbox-group" id="gridToggle">
                        <input type="checkbox" id="showGrid" checked onchange="drawPoster()">
                        <label for="showGrid">Show Grid</label>
                    </div>
                </div>

                <div class="panel">
                    <h2>üíæ Export</h2>
                    <button class="export-btn primary" onclick="exportPoster('png')">Download PNG</button>
                    <button class="export-btn secondary" onclick="exportPoster('jpeg')">Download JPEG</button>
                </div>
            </div>

            <div>
                <div class="canvas-container">
                    <canvas id="posterCanvas" width="2480" height="3508"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const cities = [
            { name: 'New York', lat: 40.7128, lon: -74.0060 },
            { name: 'London', lat: 51.5074, lon: -0.1278 },
            { name: 'Paris', lat: 48.8566, lon: 2.3522 },
            { name: 'Tokyo', lat: 35.6762, lon: 139.6503 }
        ];

        const brightStars = [
            {name: 'Sirius', ra: 6.75, dec: -16.72, mag: -1.46},
            {name: 'Canopus', ra: 6.40, dec: -52.70, mag: -0.72},
            {name: 'Arcturus', ra: 14.26, dec: 19.18, mag: -0.05},
            {name: 'Vega', ra: 18.62, dec: 38.78, mag: 0.03},
            {name: 'Capella', ra: 5.28, dec: 45.99, mag: 0.08},
            {name: 'Rigel', ra: 5.24, dec: -8.20, mag: 0.12},
            {name: 'Procyon', ra: 7.66, dec: 5.23, mag: 0.38},
            {name: 'Betelgeuse', ra: 5.92, dec: 7.41, mag: 0.50},
            {name: 'Altair', ra: 19.85, dec: 8.87, mag: 0.77},
            {name: 'Aldebaran', ra: 4.60, dec: 16.51, mag: 0.85}
        ];

        let state = { posterType: 'map', currentCity: 0, theme: 'light', fontSize: 48, customLocation: null };
        const themes = {
            light: { bg: '#FFFFFF', fg: '#000000', accent: '#666666' },
            dark: { bg: '#000000', fg: '#FFFFFF', accent: '#999999' },
            blue: { bg: '#001F3F', fg: '#FFFFFF', accent: '#7FDBFF' },
            beige: { bg: '#F5F5DC', fg: '#2C2416', accent: '#8B7355' }
        };
        let locationSearchTimeout;

        function useMyLocation() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'üìç Getting your location...';
            
            if (!navigator.geolocation) {
                alert('GPS is not supported by your browser');
                btn.disabled = false;
                btn.textContent = 'üìç Use My GPS Location';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    btn.textContent = '‚úÖ Location Found!';
                    
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
                        const data = await response.json();
                        const placeName = data.address.city || data.address.town || data.address.village || data.address.county || data.address.state || 'Your Location';
                        
                        state.customLocation = { lat, lon, name: placeName };
                        updateLocationDisplay(placeName, lat, lon);
                        document.getElementById('titleInput').value = placeName.toUpperCase();
                        document.getElementById('subtitleInput').value = `${lat.toFixed(4)}¬∞ ${lat > 0 ? 'N' : 'S'}, ${Math.abs(lon).toFixed(4)}¬∞ ${lon > 0 ? 'E' : 'W'}`;
                        document.getElementById('manualLat').value = lat.toFixed(4);
                        document.getElementById('manualLon').value = lon.toFixed(4);
                        drawPoster();
                    } catch (error) {
                        state.customLocation = { lat, lon, name: 'Your Location' };
                        updateLocationDisplay('Your Location', lat, lon);
                        document.getElementById('titleInput').value = 'YOUR LOCATION';
                        document.getElementById('subtitleInput').value = `${lat.toFixed(4)}¬∞ ${lat > 0 ? 'N' : 'S'}, ${Math.abs(lon).toFixed(4)}¬∞ ${lon > 0 ? 'E' : 'W'}`;
                        drawPoster();
                    }
                    
                    setTimeout(() => { btn.disabled = false; btn.textContent = 'üìç Use My GPS Location'; }, 2000);
                },
                (error) => {
                    btn.disabled = false;
                    btn.textContent = 'üìç Use My GPS Location';
                    let errorMsg = 'Could not get your location. ';
                    if (error.code === error.PERMISSION_DENIED) errorMsg += 'Please allow location access in your browser.';
                    else if (error.code === error.POSITION_UNAVAILABLE) errorMsg += 'Location information unavailable.';
                    else if (error.code === error.TIMEOUT) errorMsg += 'Location request timed out.';
                    alert(errorMsg);
                }
            );
        }

        function handleManualCoords() {
            const lat = parseFloat(document.getElementById('manualLat').value);
            const lon = parseFloat(document.getElementById('manualLon').value);
            if (!isNaN(lat) && !isNaN(lon) && lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                document.getElementById('manualLat').style.borderColor = '#4ade80';
                document.getElementById('manualLon').style.borderColor = '#4ade80';
            }
        }

        async function applyManualCoords() {
            const lat = parseFloat(document.getElementById('manualLat').value);
            const lon = parseFloat(document.getElementById('manualLon').value);
            
            if (isNaN(lat) || isNaN(lon)) { alert('Please enter valid coordinates'); return; }
            if (lat < -90 || lat > 90 || lon < -180 || lon > 180) { alert('Invalid coordinates range:\nLatitude: -90 to 90\nLongitude: -180 to 180'); return; }
            
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
                const data = await response.json();
                const placeName = data.address.city || data.address.town || data.address.village || data.address.county || data.address.state || 'Custom Location';
                
                state.customLocation = { lat, lon, name: placeName };
                updateLocationDisplay(placeName, lat, lon);
                document.getElementById('titleInput').value = placeName.toUpperCase();
                document.getElementById('subtitleInput').value = `${lat.toFixed(4)}¬∞ ${lat > 0 ? 'N' : 'S'}, ${Math.abs(lon).toFixed(4)}¬∞ ${lon > 0 ? 'E' : 'W'}`;
                document.getElementById('manualLat').style.borderColor = '#4ade80';
                document.getElementById('manualLon').style.borderColor = '#4ade80';
                drawPoster();
            } catch (error) {
                state.customLocation = { lat, lon, name: 'Custom Location' };
                updateLocationDisplay('Custom Location', lat, lon);
                document.getElementById('titleInput').value = 'CUSTOM LOCATION';
                document.getElementById('subtitleInput').value = `${lat.toFixed(4)}¬∞ ${lat > 0 ? 'N' : 'S'}, ${Math.abs(lon).toFixed(4)}¬∞ ${lon > 0 ? 'E' : 'W'}`;
                drawPoster();
            }
        }

        function updateLocationDisplay(name, lat, lon) {
            document.getElementById('locationDisplayText').innerHTML = `${name}<br>${lat.toFixed(4)}¬∞ ${lat > 0 ? 'N' : 'S'}, ${Math.abs(lon).toFixed(4)}¬∞ ${lon > 0 ? 'E' : 'W'}`;
            document.getElementById('currentLocationDisplay').style.display = 'block';
        }

        async function handleLocationInput() {
            const query = document.getElementById('locationSearch').value.trim();
            if (query.length < 3) { document.getElementById('locationSuggestions').style.display = 'none'; return; }

            clearTimeout(locationSearchTimeout);
            locationSearchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=5`);
                    const results = await response.json();
                    if (results.length > 0) displayLocationSuggestions(results);
                } catch (error) { console.error('Location search error:', error); }
            }, 500);
        }

        function displayLocationSuggestions(results) {
            const container = document.getElementById('locationSuggestions');
            container.innerHTML = '';
            container.style.display = 'block';

            results.forEach(result => {
                const div = document.createElement('div');
                div.style.padding = '10px';
                div.style.cursor = 'pointer';
                div.style.borderBottom = '1px solid #eee';
                div.textContent = result.display_name;
                div.onmouseover = () => div.style.background = '#f5f5f5';
                div.onmouseout = () => div.style.background = 'white';
                div.onclick = () => selectLocation(result);
                container.appendChild(div);
            });
        }

        function selectLocation(location) {
            state.customLocation = { lat: parseFloat(location.lat), lon: parseFloat(location.lon), name: location.display_name.split(',')[0] };
            document.getElementById('locationSearch').value = location.display_name;
            document.getElementById('locationSuggestions').style.display = 'none';
            updateLocationDisplay(state.customLocation.name, state.customLocation.lat, state.customLocation.lon);
            document.getElementById('titleInput').value = state.customLocation.name.toUpperCase();
            document.getElementById('subtitleInput').value = `${state.customLocation.lat.toFixed(4)}¬∞ ${state.customLocation.lat > 0 ? 'N' : 'S'}, ${Math.abs(state.customLocation.lon).toFixed(4)}¬∞ ${state.customLocation.lon > 0 ? 'E' : 'W'}`;
            document.getElementById('manualLat').value = state.customLocation.lat.toFixed(4);
            document.getElementById('manualLon').value = state.customLocation.lon.toFixed(4);
            drawPoster();
        }

        function getCurrentLocation() { return state.customLocation || cities[state.currentCity]; }

        function setPosterType(type) {
            state.posterType = type;
            document.querySelectorAll('.btn-group .btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${type}`).classList.add('active');
            document.getElementById('starControls').style.display = type === 'star' ? 'block' : 'none';
            document.getElementById('gridToggle').style.display = type === 'map' ? 'flex' : 'none';
            drawPoster();
        }

        function setTheme(theme) {
            state.theme = theme;
            document.querySelectorAll('.theme-grid .btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`theme-${theme}`).classList.add('active');
            drawPoster();
        }

        function updateFontSize() {
            state.fontSize = parseInt(document.getElementById('fontSizeInput').value);
            document.getElementById('fontSizeValue').textContent = state.fontSize;
            drawPoster();
        }

        function drawPoster() {
            const canvas = document.getElementById('posterCanvas');
            const ctx = canvas.getContext('2d');
            const w = canvas.width, h = canvas.height;
            const colors = themes[state.theme];

            ctx.fillStyle = colors.bg;
            ctx.fillRect(0, 0, w, h);

            if (state.posterType === 'map') drawMapPoster(ctx, w, h, colors);
            else if (state.posterType === 'star') drawStarPoster(ctx, w, h, colors);
            else drawTypographyPoster(ctx, w, h, colors);
        }

        function drawMapPoster(ctx, w, h, colors) {
            const cx = w / 2, cy = h / 2, scale = 3;
            ctx.strokeStyle = colors.fg;
            ctx.lineWidth = 2;
            for (let i = 1; i <= 5; i++) { ctx.beginPath(); ctx.arc(cx, cy, i * 60 * scale, 0, Math.PI * 2); ctx.stroke(); }

            if (document.getElementById('showGrid').checked) {
                const gs = 40 * scale;
                ctx.strokeStyle = colors.accent;
                ctx.lineWidth = 1;
                ctx.globalAlpha = 0.3;
                for (let x = -gs; x < w + gs; x += gs) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke(); }
                for (let y = -gs; y < h + gs; y += gs) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke(); }
                ctx.globalAlpha = 1;
            }

            ctx.strokeStyle = colors.fg;
            for (let i = 0; i < 36; i++) {
                const a = (Math.PI * 2 / 36) * i, v = Math.random() * 0.1 - 0.05;
                const ir = 100 + Math.random() * 50, or = 280 * scale + Math.random() * 100;
                ctx.globalAlpha = 0.6 + Math.random() * 0.4;
                ctx.lineWidth = 2 + Math.random() * 2;
                ctx.beginPath();
                ctx.moveTo(cx + Math.cos(a + v) * ir, cy + Math.sin(a + v) * ir);
                ctx.lineTo(cx + Math.cos(a + v) * or, cy + Math.sin(a + v) * or);
                ctx.stroke();
            }
            
            ctx.globalAlpha = 1;
            for (let i = 0; i < 8; i++) {
                const r = 150 + i * 80, sa = Math.random() * Math.PI * 2, ea = sa + Math.PI * 0.8 + Math.random() * Math.PI * 0.4;
                ctx.beginPath();
                ctx.arc(cx, cy, r * scale * 0.7, sa, ea);
                ctx.stroke();
            }

            ctx.fillStyle = colors.fg;
            ctx.beginPath();
            ctx.arc(cx, cy, 18, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = colors.bg;
            ctx.lineWidth = 4;
            ctx.stroke();

            drawPosterText(ctx, w, h, colors);
        }

        function drawStarPoster(ctx, w, h, colors) {
            const loc = getCurrentLocation();
            const date = new Date(`${document.getElementById('dateInput').value}T${document.getElementById('timeInput').value}:00`);
            const stars = calculateStarPositions(loc.lat, loc.lon, date, w, h);

            ctx.fillStyle = colors.fg;
            stars.forEach(s => {
                if (s.x >= 0 && s.x <= w && s.y >= 0 && s.y <= h * 0.7) {
                    const sz = Math.max(1, 6 - s.mag * 1.2);
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, sz, 0, Math.PI * 2);
                    ctx.fill();
                    if (s.mag < 1) {
                        const g = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, sz * 3);
                        g.addColorStop(0, colors.fg + '40');
                        g.addColorStop(1, colors.fg + '00');
                        ctx.fillStyle = g;
                        ctx.beginPath();
                        ctx.arc(s.x, s.y, sz * 3, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = colors.fg;
                    }
                }
            });

            ctx.fillStyle = colors.accent;
            for (let i = 0; i < 150; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * w, Math.random() * h * 0.7, Math.random() * 1.5 + 0.3, 0, Math.PI * 2);
                ctx.fill();
            }

            drawPosterText(ctx, w, h, colors);
        }

        function calculateStarPositions(lat, lon, date, cw, ch) {
            const jd = (date.getTime() / 86400000) + 2440587.5;
            const t = (jd - 2451545.0) / 36525.0;
            let theta = 280.46061837 + 360.98564736629 * (jd - 2451545.0) + 0.000387933 * t * t - t * t * t / 38710000.0;
            theta = theta % 360;
            if (theta < 0) theta += 360;
            const lst = ((theta + lon) % 360) / 15;
            
            const positions = [];
            brightStars.forEach(s => {
                const ha = lst - s.ra;
                const har = ha * 15 * Math.PI / 180, decr = s.dec * Math.PI / 180, latr = lat * Math.PI / 180;
                const sinAlt = Math.sin(decr) * Math.sin(latr) + Math.cos(decr) * Math.cos(latr) * Math.cos(har);
                const alt = Math.asin(sinAlt) * 180 / Math.PI;
                
                if (alt > 0) {
                    const altr = alt * Math.PI / 180;
                    const cosAz = (Math.sin(decr) - Math.sin(altr) * Math.sin(latr)) / (Math.cos(altr) * Math.cos(latr));
                    let az = Math.acos(Math.max(-1, Math.min(1, cosAz))) * 180 / Math.PI;
                    if (Math.sin(har) > 0) az = 360 - az;
                    
                    const r = ch * 0.35 * (1 - alt / 90), theta = az * Math.PI / 180;
                    positions.push({ x: cw / 2 + r * Math.sin(theta), y: ch * 0.35 - r * Math.cos(theta), mag: s.mag });
                }
            });
            return positions;
        }

        function drawTypographyPoster(ctx, w, h, colors) {
            ctx.strokeStyle = colors.accent;
            ctx.lineWidth = 2;
            for (let i = 0; i < 8; i++) {
                ctx.strokeRect(100 + i * 80, 100 + i * 80, w - 200 - i * 160, h - 200 - i * 160);
            }

            const title = document.getElementById('titleInput').value;
            const subtitle = document.getElementById('subtitleInput').value;
            ctx.fillStyle = colors.fg;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.font = `bold ${state.fontSize * 2.5}px Arial, sans-serif`;
            ctx.fillText(title, w / 2, h / 2 - 80);
            ctx.font = `${state.fontSize}px Arial, sans-serif`;
            ctx.fillText(subtitle, w / 2, h / 2 + 80);
        }

        function drawPosterText(ctx, w, h, colors) {
            const title = document.getElementById('titleInput').value;
            const subtitle = document.getElementById('subtitleInput').value;
            const message = document.getElementById('messageInput').value;

            ctx.fillStyle = colors.fg;
            ctx.textAlign = 'center';
            ctx.font = `bold ${state.fontSize * 1.2}px Arial, sans-serif`;
            ctx.fillText(title, w / 2, h - 300);
            ctx.font = `${state.fontSize * 0.6}px Arial, sans-serif`;
            ctx.fillText(subtitle, w / 2, h - 220);

            if (message) {
                ctx.font = `italic ${state.fontSize * 0.5}px Georgia, serif`;
                ctx.fillStyle = colors.accent;
                ctx.fillText(message, w / 2, h - 160);
            }

            ctx.strokeStyle = colors.fg;
            ctx.lineWidth = 4;
            ctx.strokeRect(30, 30, w - 60, h - 60);
        }

        function exportPoster(format) {
            const canvas = document.getElementById('posterCanvas');
            const link = document.createElement('a');
            link.download = `poster_${Date.now()}.${format}`;
            link.href = canvas.toDataURL(`image/${format}`, 1.0);
            link.click();
        }

        drawPoster();
    </script>
</body>
</html>
